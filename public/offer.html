<!doctype html>
<html>

<head>
    <!-- Bootstrap & base head -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <script defer src="/js/app.js"></script>

    <title>Offer</title><!-- head shared -->
</head>

<body>
    <!-- navbar -->
    <nav class="navbar navbar-expand-lg bg-light border-bottom mb-4">
        <div class="container">
            <a class="navbar-brand" href="/index.html">EventoJob</a>
            <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="nav" class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="/offers.html">Offers</a></li>
                </ul>
                <ul class="navbar-nav ms-auto" id="nav-right">
                    <!-- filled by app.js: login/register OR user menu -->
                </ul>
            </div>
        </div>
    </nav>

    <div class="container" id="offer"></div>

    <script>
        async function loadOffer() {
            const container = document.getElementById("offer");
            const id = qs("id");
            if (!id) { container.textContent = "Missing id."; return; }

            try {
                const res = await api(`/offers/${id}`);
                if (res.status === 401) { location.href = "/login.html"; return; }
                if (!res.ok) { container.textContent = "Not found."; return; }

                const j = await res.json();

                // Handle both shapes: id as string OR { value: string }
                const offerId = typeof j.id === "string" ? j.id : (j.id && j.id.value);
                // Your API nests details under description; fall back to root if you later flatten
                const d = j.description || j;
                console.log(d)
                const title = d.title ?? "";
                const location = d.location ?? "";
                const desc = d.description ?? "";
                const salary = d.salary ?? null;

                const start = d.start_date ? new Date(d.start_date) : null;
                const end = d.end_date ? new Date(d.end_date) : null;

                // If you don't have a status, infer "open" if end date is in the future
                const isOpen = j.status ? (j.status === "open") : (end ? end > new Date() : true);

                container.innerHTML = `
              <h2>${title}</h2>
              ${desc ? `<p>${desc}</p>` : ""}
              <p class="text-muted">${location}</p>
              ${start && end ? `<p><strong>When:</strong> ${start.toLocaleString()} â†’ ${end.toLocaleString()}</p>` : ""}
              ${salary !== null ? `<p><strong>Pay:</strong> ${fmtMoney(salary)}</p>` : ""}
              ${isOpen && offerId
                        ? `<a class="btn btn-dark" href="/apply.html?id=${offerId}">Apply</a>`
                        : `<span class="badge text-bg-secondary">Closed</span>`}
            `;
            } catch (err) {
                console.error(err);
                container.textContent = "Error loading offer.";
            }
        }
        document.addEventListener("DOMContentLoaded", loadOffer);
    </script>

</body>

</html>